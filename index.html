<!-- *********************************************************************** -->
<!--                                                                         -->
<!--                                                      :::      ::::::::  -->
<!-- index.html                                         :+:      :+:    :+:  -->
<!--                                                  +:+ +:+         +:+    -->
<!-- By: abderrahim <marvin@42.fr>                  +#+  +:+       +#+       -->
<!--                                              +#+#+#+#+#+   +#+          -->
<!-- Created: 2024/11/16 16:02:47 by abderrahim        #+#    #+#            -->
<!-- Updated: 2024/11/18 13:51:32 by abderrahim       ###   ########.fr      -->
<!--                                                                         -->
<!-- *********************************************************************** -->

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>LEETMAKERS</title>
	<link rel="stylesheet" href="base.css" />
	<link rel="stylesheet" href="layout.css" />
	<link rel="stylesheet" href="style.css" />
	<script>
		function getCookie(name) {
			let matches = document.cookie.match(new RegExp(
				"(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
			));
			return (matches ? decodeURIComponent(matches[1]) : undefined);
		}

		function setCookie(name, value, attributes = {}) {
			attributes = {
				path: '/',
				// add other defaults here if necessary
				...attributes
			};
			if (attributes.expires instanceof Date)
				attributes.expires = attributes.expires.toUTCString();
			let updatedCookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);
			for (let attributeKey in attributes) {
				updatedCookie += "; " + attributeKey;
				let attributeValue = attributes[attributeKey];
				if (attributeValue !== true)
					updatedCookie += "=" + attributeValue;
			}
			document.cookie = updatedCookie;
		}

		function deleteCookie(name) {
			setCookie(name, "", { 'max-age': -1 });
		}
	</script>
	<script>
		const cookie_name_session = "sid";

		function ElementLock(cookie) {
			const cookie_session = getCookie(cookie_name_session);
			function createUnlock() {
				const template = document.getElementById("tmpl_unlock");
				const button = template.content.firstElementChild.cloneNode(true);
				button.addEventListener("click", function (event) {
					const dialog = document.getElementById("dialog_unlock");
					const input_redirect = dialog.querySelector("#redirect");
					input_redirect.value = String(window.location);
					dialog.showModal();
				});
				return (button);
			}
			function createLock() {
				const template = document.getElementById("tmpl_lock");
				const form = template.content.firstElementChild.cloneNode(true);
				form.cookie.value = cookie_session;
				form.redirect.value = String(window.location);
				return (form);
			}
			if (!cookie_session)
				return (createUnlock());
			return (createLock());
		}
	</script>
</head>
<body>
	<header id="topbar">
		<h1>LEETMAKERS<small> / DASHBOARD</small></h1>
		<span class="space-x"></span>
	</header>
	<dialog id="dialog_unlock">
		<form method="POST" action="/api/session/obtain" class="contents">
			<label for="secret">Secret:</label>
			<input type="password" id="secret" name="secret" placeholder="Type in inventory manager secret..." required />
			<input type="hidden" id="redirect" name="redirect" />
			<button type="submit" class="lock">Sign in</button>
		</form>
	</dialog>
	<template id="tmpl_unlock">
		<button type="button" class="lock">Manage</button>
	</template>
	<template id="tmpl_lock">
		<form method="POST" action="/api/session/drop" class="contents">
			<input type="hidden" id="cookie" name="session_id" />
			<input type="hidden" id="redirect" name="redirect" />
			<button type="submit" class="lock">Sign out</button>
		</form>
	</template>
	<script>
		const slot = document.getElementById("topbar");
		const frag = ElementLock();
		slot.insertAdjacentElement("beforeend", frag);
	</script>
</body>
</html>
